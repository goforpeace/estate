rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if a user is signed in.
    function isSignedIn() {
      return request.auth != null;
    }

    // Helper function to check if the signed-in user is an admin.
    // This assumes a specific UID for the admin user. 
    // For a real app, you might use custom claims instead.
    function isAdmin() {
      // Allow any authenticated user for this simplified example.
      // In a real app, you'd check for a specific admin UID or a custom claim.
      // e.g., return request.auth.uid == 'YOUR_ADMIN_UID';
      // or return request.auth.token.isAdmin == true;
      return isSignedIn();
    }
    
    // Rules for the 'tenants' collection
    match /tenants/{tenantId} {
      // Admins can read, write, create, and delete any tenant document.
      allow read, write: if isAdmin();
    }

    // Tenant-specific data
    match /tenants/{tenantId}/{document=**} {
        // For now, allow any signed-in user to access sub-collections.
        // In a multi-tenant app, you'd restrict this to users of that tenant.
        allow read, write: if isSignedIn();
    }
  }
}
